

# 基于简易devops实现的gitlab2prd落地方案设计   





[TOC]

### 总体目标

1. 需求管理

   增加epic功能，需求依赖，需求和任务及产品关联

2. 产品化

   代码版本和发布包版本，主备人员，开发状态，文档手册，依赖包管理。

3. 项目流程

   Gitlab flow，webIDE-remoteIDE，测试，集成，交付。

4. 资源环境

   人力能力，计算资源，开发环境镜像（one system one compose）。

5. CICD容器

   CI环境复用开发环境，CD测试环境部署容器。UAT环境同生产容器化。

6. 计划和跟踪

   项目各角色之间的沟通协作，任务管理

7. 安全隔离

   权限细化，注重内外网隔离环境的使用，小程序及外部联调白名单。

8. 汉化和指引

   project-产品， 组织-产品-代码库/模块

9. 待续


### 需求管理层级

#### 项目Epic（仓库）

项目是最高级别的任务，一般由合作合同而来，或者年度规划而形成。一般是公司级别的任务。

| 字段      | 描述                 | 约束   | 示例                                           |
| --------- | -------------------- | ------ | ---------------------------------------------- |
| Id | 项目编号             | 唯一   | ‘P001'                                         |
|Name|项目名称||'网站开发二期'|
| Describe | 对项目的解释文字    |        | '网站增加聚合功能，包含资讯，产品，招聘等内容' |
| Contract | 签署本项目的合同编号 | 可为空 | ‘C0001'                                        |

#### 需求Feature（目录）

需求是项目从空间角度细分而来（非用户需求除外），但必须满足可以单独上线为基本条件，即所有未上线的需求之间不应该存在业务依赖关系。存在依赖关系的需求应合并为一。用户需求一般由需求工程师完成。

| 字段      | 描述               | 约束   | 示例                       |
| --------- | ------------------ | ------ | -------------------------- |
| RequireID | 需求编号           | 唯一   | 2                          |
| ProjectID | 所属的项目         | 可为空 | 1，非用户需求时为空        |
| Type      | 类型               |        | 用户需求/优化重构/运维需求 |
| Desc      | 对需求点的解释文字 |        | '增加资讯聚合功能'         |



#### 迭代Story（文件）

迭代需求从时间角度细分而来，但必须满足可以作为阶段性功能提前上线（并非交付）为基本条件。也就是说同一需求的各迭代之间不应该存在双向业务依赖或者闭环业务依赖关系。迭代划分有需求创建者完成，仅有一个迭代的需求系统会自动帮助完成。

| 字段     | 描述                 | 约束 | 示例               |
| -------- | -------------------- | ------ | ------------------ |
| phaseID | 迭代编号           | 唯一   | 2                  |
| frontID	|前置迭代ID | 可为空 |1|
| ReqireID |所属的需求ID号      |  | 1|
| Desc | 对需求点的解释文字   |        | '增加资讯聚合功能' |
| ExpectFinDate | 希望完成日期 | 可为空 | 2018-10-01 |
| DevelopModel | 开发模式 | | 敏捷/稳态。一般由优先级和类型决定，自动填写 |



#### 功能点function（item）

功能点是由迭代细分而来，并落实到需要改造的产品上（或者需要创建的新产品）。功能点之间可以存在依赖关系。此工作一般有架构师完成。

| 字段          | 描述         | 约束   | 示例                                        |
| ------------- | ------------ | ------ | ------------------------------------------- |
| phaseID       | 所属的迭代ID | 联合主键 | 1迭代1产品仅含有1个功能ID                   |
| ProductID     | 产品号       | 联合主键 | 可用git仓库名                                |
| issueID | 对应创建的issueID |  |  |



以上内容全部以项目为仓库，存储到文件系统。

以下内容存储到各产品的仓库中。

#### 问题issue（改造）

在产品仓库级被自动创建的issue中，存在指向迭代ID的label，便于反向检索。

产品负责人（即产品主副岗）将产品级的issue复制到可能被修改的模块（子仓库）中，同时自动创建与之对应的MergeRequest分支。模块中的issue和其产品级的父issue之间需要双向链接，同样代码合并后自动关闭父issue。

一个产品的缺陷登记，也记录在产品级的issue列表中，而不是各自的模块issue列表。



#### 任务task（新增）

在模块中，一个branch分支对应一个issue或者bugfix。但是，如果一个issue工作量过大，产品主岗或程序员可以将其细分出多个task（甚至多层级的task）并将其分配给其他开发同事。他们在同一个branch上开发，通过中央仓库合并代码进行写协作。同时尽量做到一个task对于一次commit。



### 工作流workflow





### 相关文档

这两种模态分别是：可预测IT，运行着企业的关键应用，对可靠性和稳定性要求极高，对经济性和成本的考虑比较多，是企业业务的高性能基础架构;敏捷式IT，强调速度和敏捷性，以快速部署应用促进业务快速发展、支持提高开发团队的开发效率、缩短开发周期、快速开发并及时采纳新技术。

麦肯锡提出了双速IT、华为提出了NEWICT、联想提出了双态IT，而另外一些IT咨询公司如埃森哲、德勤等。Gartner认为，所有的企业都应该走双模IT的道路，因为所有企业都会受到数字化的冲击，所有企业的IT都面临可预见的工作和探索性的工作。

越是下层的系统，越适合模式1的IT；而越是上层的系统，就越适合模式2的开发。所以系统优化重构适用于传统的稳态开发模式。

双模IT是管理两种独立且一致的IT交付模式的做法，一种侧重于稳定性，另一种侧重于敏捷性。模式1是传统和线性的，强调安全和稳定。模式2是探索和非线性的，强调敏捷性和速度。













```json
/* 需求 */
{
    ReqirementID: 1,
    Desc: '网站增加聚合功能，包含资讯，产品，招聘等内容'，
    ContractRef: 'C0001' //合同编号，可选
}

/* 需求点 */
[
    {
        RequirePointID:1,
        ReqirementID:1,
        Desc: '增加资讯聚合功能',
        ExpectFinDate: '2018-03-01',
        developModel: '敏捷',
    },
    {
        RequirePointID:2,
        ReqirementID:1,
        Desc: '增加招聘聚合功能',
        ExpectFinDate: '2018-04-01',
        developModel: '敏捷'
    },
    {
        RequirePointID:3,
        ReqirementID:1,
        Desc: '增加产品聚合功能',
        ExpectFinDate: '2018-12-31',
        developModel: '稳态'，
    },
    {
        RequirePointID:4,
        ReqirementID:null,
        Desc: '开发抓包框架',
        ExpectFinDate: '2018-03-01',
        Source: '开发'
        developModel: '稳态'
    },
]

```



表达式-函数-类(include)-包模块（import/require）-库（LD_LIBRARY_PATH,maven）

