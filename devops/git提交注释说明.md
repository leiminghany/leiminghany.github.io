# 关于Git提交注释的注意事项

2008年4月19日



原文参考（https://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html）

我想花点时间详细说明怎样创建良好格式的提交注释（或提交消息）。 我认为提交注释格式化的最佳实践是让Git变得更好的一个小细节。 可以理解的是，对rails.git的第一次提交有一些真正长线的消息，我想展开说为什么这是一个糟糕的做法。

这是一个Git提交消息的模范：

```
Capitalized, short (50 chars or less) summary

如有必要，更详细的说明文字。 包裹它到约一行72字符左右。 在某些情况下，第一行被视为电子邮件的主题，然后文本的其余部分作为正文。 空白将摘要与正文分开的行是至关重要的（除非您省略整个主体）; 如果两者混在一起像rebase这样的工具可能会让你感到困惑。

紧急时写下你的提交信息：“Fix bug”而不是“Fixed bug”或“Fixes bug。” 此约定与通过像git merge和git revert这样的命令生成的提交消息匹配。

之后的段落跟在空白行后面。

- Bullet points are okay, too

- 通常使用连字符或星号用于Bullet，后跟单个空格，中间有空行，但通常此处会有差异

- 使用悬挂缩进
```

我们带着一些疑问开始，为什么将提交消息压缩到72列是一件好事。

- `git log`不会对提交消息做任何特殊的压缩，由于less -s命令默认的页面方案，你的段落会远远落在屏幕之外，这让我们很难阅读。在80列的终端上，我们减去左侧4列缩进以及右侧的对称缩进。这就剩下72列了。
- `git format-patch —stdout` 将一系列提交转为email，使用了提交消息做为邮件内容。好的邮件礼仪指示我们压缩纯文本电子邮件，以便在80列终端中显示几个级别的嵌套回复指示符后不会溢出。（目前的rails.git工作流程不包含电子邮件，但谁知道未来会怎样呢）

Vim用户可以通过安装我的vim-git运行时文件，或者只需在你的git commit消息文件中设置以下选项来满足这个要求：

```bash
:set textwidth=72
```

对于Textmate，您可以在视图菜单下调整“Wrap Column”选项，然后使用^ Q重新包装段落（确保最后有一个空行以避免在评论中混合）。 这是一个shell命令，可以在菜单中添加72，因此您无需每次都拖动以进行选择：

```bash
$ defaults write com.macromates.textmate OakWrapColumns '( 40, 72, 78 )'
```

比格式化主体的机制更重要的是具有主题线的实践。 如示例所示，您应该敲击大约50个字符（尽管这不是硬性限制）并始终使用空行跟随它。 第一行应该是本次提交所引入更改的简明摘要; 如果有任何技术细节无法在这些严格的尺寸限制中表达，请将它们放入体内。 主题行在整个Git中使用，如果使用了太长的消息，通常会以截断的形式使用。 以下是一些最终结果的例子：

- `git log --pretty=oneline`显示包含提交ID和摘要的简洁历史记录映射
- `git rebase —interactive`在它调用的编辑器中提供每个提交的摘要
- 如果设置了config选项merge.summary，则所有合并提交的摘要将进入合并提交消息
- `git shortlog`在它生成的类似changelog的输出中使用摘要条目
- `git format-patch`，`git send-email`和相关工具将它用作电子邮件的主题
- reflogs，一个可以使用`git reflog`访问的本地历史记录，旨在帮助您从愚蠢的错误中恢复，获取摘要的副本
- gitk有一个摘要列
- GitHub在其用户界面中的各个位置使用摘要

主题/主体的区别可能看起来并不重要，但它是许多微妙的因素之一，使得Git历史比Subversion更令人愉快。